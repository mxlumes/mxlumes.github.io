<!-- MX-LUMES FINAL PRODUCTION ENGINE v2.0 -->
<!-- FULL READY CODE -->

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
/* ================================
   CONFIG
================================ */

const RAZORPAY_KEY = "YOUR_RAZORPAY_KEY_HERE";
const WHATSAPP_NUMBER = "919876543210";

/* ================================
   CART ENGINE (PERSISTENT)
================================ */

let cart = JSON.parse(localStorage.getItem("mx_cart")) || [];

function saveCart(){
    localStorage.setItem("mx_cart", JSON.stringify(cart));
}

function addToCart(name, price){

    const existing = cart.find(i => i.name === name);

    if(existing){
        existing.qty++;
    }else{
        cart.push({
            name,
            price,
            qty:1
        });
    }

    saveCart();
    renderCart();
    showToast("Added to cart");
}

function buyNow(name, price){

    cart = [{
        name,
        price,
        qty:1
    }];

    saveCart();
    renderCart();
    openCheckoutSelector();
}

function removeFromCart(index){

    cart.splice(index,1);

    saveCart();
    renderCart();
}

function changeQty(index, delta){

    cart[index].qty += delta;

    if(cart[index].qty <=0)
        cart.splice(index,1);

    saveCart();
    renderCart();
}

function getCartTotal(){

    return cart.reduce((t,i)=> t + (i.price * i.qty),0);
}

function renderCart(){

    const container =
        document.getElementById("cartItems");

    if(!container) return;

    container.innerHTML="";

    let total = 0;
    let count = 0;

    cart.forEach((item,index)=>{

        const itemTotal =
            item.price * item.qty;

        total += itemTotal;
        count += item.qty;

        container.innerHTML += `
        <div style="margin-bottom:15px;border-bottom:1px solid #222;padding-bottom:10px;">
        
            <div style="display:flex;justify-content:space-between;">
                <b>${item.name}</b>
                <span>₹${itemTotal}</span>
            </div>

            <div style="display:flex;justify-content:space-between;margin-top:6px;">

                <div>
                    <button onclick="changeQty(${index},-1)">−</button>
                    <span style="margin:0 10px">${item.qty}</span>
                    <button onclick="changeQty(${index},1)">+</button>
                </div>

                <button onclick="removeFromCart(${index})"
                style="color:red;">Remove</button>

            </div>

        </div>
        `;
    });

    document.getElementById("cartTotal").innerText =
        "₹" + total.toLocaleString();

    document.getElementById("cartCount").innerText =
        count;
}

/* ================================
   WHATSAPP CHECKOUT
================================ */

function checkoutWhatsApp(){

    if(cart.length===0){
        alert("Cart empty");
        return;
    }

    let msg="Order Request:%0A";

    cart.forEach(item=>{
        msg += `${item.name} x${item.qty} = ₹${item.price*item.qty}%0A`;
    });

    msg += `%0ATotal: ₹${getCartTotal()}`;

    window.open(
        `https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`,
        "_blank"
    );
}

/* ================================
   RAZORPAY CHECKOUT
================================ */

function checkoutRazorpay(){

    if(cart.length===0){
        alert("Cart empty");
        return;
    }

    if(RAZORPAY_KEY==="YOUR_RAZORPAY_KEY_HERE"){
        alert("Add Razorpay Key first");
        return;
    }

    const total =
        getCartTotal() * 100;

    const options = {

        key: RAZORPAY_KEY,

        amount: total,

        currency:"INR",

        name:"M-X LUMES",

        description:"Resin Order",

        handler:function(response){

            showToast("Payment Successful");

            cart=[];
            saveCart();
            renderCart();
        },

        theme:{
            color:"#ffffff"
        }

    };

    const rzp =
        new Razorpay(options);

    rzp.open();
}

/* ================================
   CHECKOUT SELECTOR
================================ */

function openCheckoutSelector(){

    if(cart.length===0){
        alert("Cart empty");
        return;
    }

    const choice =
        confirm(
            "Press OK for Razorpay Payment\nCancel for WhatsApp Order"
        );

    if(choice)
        checkoutRazorpay();
    else
        checkoutWhatsApp();
}

/* ================================
   UI HELPERS
================================ */

function toggleCart(){

    document
        .getElementById("cartSidebar")
        .classList.toggle("active");
}

function showToast(msg){

    const t =
        document.getElementById("toast");

    if(!t) return;

    t.innerText = msg;

    t.classList.add("show");

    setTimeout(()=>{
        t.classList.remove("show");
    },2000);
}

/* ================================
   INIT
================================ */

renderCart();

</script>
